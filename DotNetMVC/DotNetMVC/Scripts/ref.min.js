dojo._hasResource["dojox.json.ref"]||(dojo._hasResource["dojox.json.ref"]=!0,dojo.provide("dojox.json.ref"),dojo.require("dojo.date.stamp"),dojox.json.ref={resolveJson:function(n,t){function s(p,w,b,k,d,g){var nt,ot,it,rt=u in p?p[u]:b,tt,st,ht,et,ct,ut,lt,ft;for((u in p||rt!==undefined&&k)&&(rt=(f+rt).replace(o,"$2$3")),tt=g||p,rt!==undefined&&(v&&(p.__id=rt),!t.schemas||p instanceof Array||!(it=rt.match(/^(.+\/)[^\.\[]*$/))||(d=t.schemas[it[1]]),i[rt]&&p instanceof Array==i[rt]instanceof Array?(tt=i[rt],delete tt.$ref,delete tt._loadObject,ot=!0):(st=d&&d.prototype,st&&(l.prototype=st,tt=new l)),i[rt]=tt,c&&(c[rt]=t.time));d;){if(ht=d.properties,ht)for(nt in p)et=ht[nt],et&&et.format=="date-time"&&typeof p[nt]=="string"&&(p[nt]=dojo.date.stamp.fromISOString(p[nt]));d=d["extends"]}ct=p.length;for(nt in p){if(nt==ct)break;if(p.hasOwnProperty(nt)&&(it=p[nt],typeof it!="object"||!it||it instanceof Date||nt=="__parent"||(r=it[h]||a&&it[u],r&&it.__parent||p!=e&&(it.__parent=tt),r?(delete p[nt],ut=r.toString().replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/),i[(f+r).replace(o,"$2$3")]?r=i[(f+r).replace(o,"$2$3")]:(r=ut[1]=="$"||ut[1]=="this"||ut[1]==""?n:i[(f+ut[1]).replace(o,"$2$3")])&&ut[3]&&ut[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(n,t,i,u,f){r=r&&r[i?i.replace(/[\"\'\\]/,""):f]}),r?it=r:w||(lt||e.push(tt),lt=!0,it=s(it,!1,it[h],!0,et),it._loadObject=t.loader)):w||(it=s(it,e==p,rt===undefined?undefined:y(rt,nt),!1,et,tt!=p&&typeof tt[nt]=="object"&&tt[nt]))),p[nt]=it,tt!=p&&!tt.__isDirty&&(ft=tt[nt],tt[nt]=it,ot&&it!==ft&&!tt._loadObject&&!(nt.charAt(0)=="_"&&nt.charAt(1)=="_")&&nt!="$ref"&&!(it instanceof Date&&ft instanceof Date&&it.getTime()==ft.getTime())&&!(typeof it=="function"&&typeof ft=="function"&&it.toString()==ft.toString())&&i.onUpdate)))i.onUpdate(tt,nt,ft,it)}if(ot&&(u in p||tt instanceof Array)){for(nt in tt)if(!tt.__isDirty&&tt.hasOwnProperty(nt)&&!p.hasOwnProperty(nt)&&!(nt.charAt(0)=="_"&&nt.charAt(1)=="_")&&!(tt instanceof Array&&isNaN(nt))){if(i.onUpdate&&nt!="_loadObject"&&nt!="_idAttr")i.onUpdate(tt,nt,tt[nt],undefined);for(delete tt[nt];tt instanceof Array&&tt.length&&tt[tt.length-1]===undefined;)tt.length--}}else if(i.onLoad)i.onLoad(tt);return tt}t=t||{};var u=t.idAttribute||"$id",h=this.refAttribute,a=t.idAsRef,f=t.idPrefix||"",v=t.assignAbsoluteIds,i=t.index||{},c=t.timeStamps,r,e=[],o=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,y=this._addProp,l=function(){};return n&&typeof n=="object"&&(n=s(n,!1,t.defaultId,!0),s(e,!1)),n},fromJson:function(str,_1c){function ref(n){var t={};return t[this.refAttribute]=n,t}try{var _1f=eval("("+str+")")}catch(e){throw new SyntaxError("Invalid JSON string: "+e.message+" parsing: "+str);}return _1f?this.resolveJson(_1f,_1c):_1f},toJson:function(n,t,i,r){function f(n,r,s){var h,p,w,nt,k,a,d,g;if(typeof n=="object"&&n){if(n instanceof Date)return'"'+dojo.date.stamp.toISOString(n,{zulu:!0})+'"';if(h=n.__id,h){if(r!="#"&&(c&&!h.match(/#/)||e[h]))return p=h,h.charAt(0)!="#"&&(p=n.__clientId==h?"cid:"+h:h.substring(0,i.length)==i?h.substring(i.length):h),w={},w[l]=p,f(w,"#");r=h}else n.__id=r,u[r]=n;e[r]=n;s=s||"";var v=t?s+dojo.toJsonIndentStr:"",y=t?"\n":"",b=t?" ":"";if(n instanceof Array)return nt=dojo.map(n,function(n,t){var i=f(n,o(r,t),v);return typeof i!="string"&&(i="undefined"),y+v+i}),"["+nt.join(","+b)+y+s+"]";k=[];for(a in n)if(n.hasOwnProperty(a)){if(typeof a=="number")d='"'+a+'"';else if(typeof a=="string"&&(a.charAt(0)!="_"||a.charAt(1)!="_"))d=dojo._escapeString(a);else continue;if(g=f(n[a],o(r,a),v),typeof g!="string")continue;k.push(y+v+d+":"+b+g)}return"{"+k.join(","+b)+y+s+"}"}return typeof n=="function"&&dojox.json.ref.serializeFunctions?n.toString():dojo.toJson(n)}var c=this._useRefs,o=this._addProp,l=this.refAttribute,e,u,s,h;if(i=i||"",e={},u={},s=f(n,"#",""),!r)for(h in u)delete u[h].__id;return s},_addProp:function(n,t){return n+(n.match(/#/)?n.length==1?"":".":"#")+t},refAttribute:"$ref",_useRefs:!1,serializeFunctions:!1});
//# sourceMappingURL=ref.min.js.map
